package org.scoula.jeonseRate.enums;

import java.util.Arrays;
import java.util.Optional;

/**
 * KOSIS API에서 사용하는 지역(objL2) 코드 Enum
 * - 사용자 입력 주소의 구명을 기반으로 KOSIS 지역 코드를 매핑하기 위해 사용
 * - 예: 마포구 → "마포" → "a7010303"
 */
public enum KosisRegionDistrictCode {
    종로("종로", "a7010101"),
    중_서울("중", "a7010102"),
    용산("용산", "a7010103"),
    성동("성동", "a7010201"),
    광진("광진", "a7010202"),
    동대문("동대문", "a7010203"),
    중랑("중랑", "a7010204"),
    성북("성북", "a7010205"),
    강북("강북", "a7010206"),
    도봉("도봉", "a7010207"),
    노원("노원", "a7010208"),
    은평("은평", "a7010301"),
    서대문("서대문", "a7010302"),
    마포("마포", "a7010303"),
    양천("양천", "a7020101"),
    강서_서울("강서", "a7020102"),
    로("구로", "a7020103"),
    금천("금천", "a7020104"),
    영등포("영등포", "a7020105"),
    동작("동작", "a7020106"),
    관악("관악", "a7020107"),
    서초("서초", "a7020201"),
    강남("강남", "a7020202"),
    송파("송파", "a7020203"),
    강동("강동", "a7020204"),
    과천("과천", "a80101"),
    만안("만안", "a8010201"),
    동안("동안", "a8010202"),
    수정("수정", "a8010301"),
    중원("중원", "a8010302"),
    분당("분당", "a8010303"),
    군포("군포", "a80104"),
    의왕("의왕", "a80105"),
    안성("안성", "a80201"),
    처인("처인", "a8020201"),
    기흥("기흥", "a8020202"),
    수지("수지", "a8020203"),
    장안("장안", "a8020301"),
    권선("권선", "a8020302"),
    팔달("팔달", "a8020303"),
    영통("영통", "a8020304"),
    원미("원미", "a8030101"),
    소사("소사", "a8030102"),
    오정("오정", "a8030103"),
    상록("상록", "a8030201"),
    단원("단원", "a8030202"),
    시흥("시흥", "a80303"),
    광명("광명", "a80304"),
    화성("화성", "a80305"),
    오산("오산", "a80306"),
    평택("평택", "a80307"),
    남양주("남양주", "a80401"),
    구리("구리", "a80402"),
    하남("하남", "a80403"),
    광주("광주", "a80404"),
    이천("이천", "a80501"),
    여주("여주", "a80502"),
    김포("김포", "a80601"),
    덕양("덕양", "a8060201"),
    일산동("일산동", "a8060202"),
    일산서("일산서", "a8060203"),
    파주("파주", "a80603"),
    포천("포천", "a80701"),
    동두천("동두천", "a80702"),
    양주("양주", "a80703"),
    의정부("의정부", "a80704"),
    중_인천("중", "a901"),
    동_인천("동", "a902"),
    미추홀("미추홀", "a903"),
    연수("연수", "a904"),
    남동("남동", "a905"),
    부평("부평", "a906"),
    계양("계양", "a907"),
    서_인천("서", "a908"),
    중_부산("중", "b10101"),
    서_부산("서", "b10102"),
    동_부산("동", "b10103"),
    영도("영도", "b10104"),
    부산진("부산진", "b10105"),
    남_부산("남", "b10106"),
    연제("연제", "b10107"),
    수영("수영", "b10108"),
    해운대("해운대", "b10201"),
    금정("금정", "b10202"),
    동래("동래", "b10203"),
    기장("기장", "b10204"),
    북_부산("북", "b10301"),
    강서_부산("강서", "b10302"),
    사상("사상", "b10303"),
    사하("사하", "b10304"),
    중_대구("중", "b201"),
    동_대구("동", "b202"),
    서_대구("서", "b203"),
    남_대구("남", "b204"),
    북_대구("북", "b205"),
    수성("수성", "b206"),
    달서("달서", "b207"),
    달성("달성", "b208"),
    동_광주("동", "b301"),
    서_광주("서", "b302"),
    남_광주("남", "b303"),
    북_광주("북", "b304"),
    광산("광산", "b305"),
    동_대전("동", "b401"),
    중_대전("중", "b402"),
    서_대전("서", "b403"),
    유성("유성", "b404"),
    대덕("대덕", "b405"),
    중_울산("중", "b501"),
    남_울산("남", "b502"),
    동_울산("동", "b503"),
    북_울산("북", "b504"),
    울주("울주", "b505"),
    세종("세종", "b6"),
    춘천("춘천", "c101"),
    원주("원주", "c102"),
    강릉("강릉", "c103"),
    동해("동해", "c104"),
    태백("태백", "c105"),
    속초("속초", "c106"),
    삼척("삼척", "c107"),
    상당("상당", "c20101"),
    서원("서원", "c20102"),
    흥덕("흥덕", "c20103"),
    청원("청원", "c20104"),
    상당_구("구)상당", "c20201"),
    흥덕_구("구)흥덕", "c20202"),
    충주("충주", "c203"),
    제천("제천", "c204"),
    청원_구("구)청원", "c205"),
    음성("음성", "c206"),
    천안("천안", "c301"),
    동남("동남", "c302"),
    서북("서북", "c303"),
    공주("공주", "c304"),
    보령("보령", "c305"),
    아산("아산", "c306"),
    서산("서산", "c307"),
    논산("논산", "c308"),
    계룡("계룡", "c309"),
    연기("연기", "c310"),
    홍성("홍성", "c311"),
    예산("예산", "c312"),
    당진("당진", "c313"),
    전주("전주", "c401"),
    완산("완산", "c402"),
    덕진("덕진", "c403"),
    군산("군산", "c404"),
    익산("익산", "c405"),
    정읍("정읍", "c406"),
    남원("남원", "c407"),
    김제("김제", "c408"),
    목포("목포", "c501"),
    여수("여수", "c502"),
    순천("순천", "c503"),
    나주("나주", "c504"),
    광양("광양", "c505"),
    무안("무안", "c506"),
    경주("경주", "c601"),
    구미("구미", "c602"),
    남_경북("남", "c60301"),
    북_경북("북", "c60302"),
    김천("김천", "c604"),
    안동("안동", "c605"),
    영주("영주", "c606"),
    영천("영천", "c607"),
    상주("상주", "c608"),
    문경("문경", "c609"),
    경산("경산", "c610"),
    칠곡("칠곡", "c611"),
    의창("의창", "c70101"),
    성산("성산", "c70102"),
    마산합포("마산합포", "c70103"),
    마산회원("마산회원", "c70104"),
    진해("진해", "c702"),
    진주("진주", "c703"),
    통영("통영", "c704"),
    사천("사천", "c705"),
    김해("김해", "c706"),
    밀양("밀양", "c707"),
    거제("거제", "c708"),
    양산("양산", "c709"),
    제주("제주", "c801"),
    서귀포("서귀포", "c802");

    private final String name;
    private final String code;

    KosisRegionDistrictCode(String name, String code) {
        this.name = name;
        this.code = code;
    }

    public String getName() { return name; }
    public String getCode() { return code; }

    /**
     * 시군구명(name)과 시도 코드 접두(prefix)를 함께 비교해서 정확한 지역 enum을 찾는다
     * 예: name="중", sidoPrefix="a7" → code가 a7로 시작하는 중구만 필터링
     */
    public static Optional<KosisRegionDistrictCode> fromNameAndSiDoPrefix(String name, String sidoCodePrefix) {
        return Arrays.stream(values())
                .filter(r -> r.name.equals(name) && r.code.startsWith(sidoCodePrefix))
                .findFirst();

    }

    /**
     * 주소 API에서 넘어온 행정구역 이름을 정규화 (구, 군, 시 제거)
     */
    public static String normalizeDistrictName(String raw) {
        if (raw == null) return null;
        return raw.replaceAll("(시|군|구)$", "").trim();
    }

    public static Optional<KosisRegionDistrictCode> findBySiDoAndSgg(String siNm, String sggNm) {
        String siDoCodePrefix = KosisRegionCode.findCodeFromRawRegionName(siNm).orElse(null);
        if (siDoCodePrefix == null) return Optional.empty();

        String normalizedSgg = normalizeDistrictName(sggNm);

        return fromNameAndSiDoPrefix(normalizedSgg, siDoCodePrefix);
    }


}
